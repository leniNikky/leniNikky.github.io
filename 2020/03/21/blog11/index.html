

<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="description" content="">
    <title>Koa2基础学习 | Coding with cooker&#39; soul</title>

    <!-- Open Graph -->
    <meta name="description" content="&amp;#x642D;&amp;#x5EFA;koa&amp;#x5F00;&amp;#x53D1;&amp;#x73AF;&amp;#x5883;koa&amp;#x57FA;&amp;#x4E8E;async&amp;#xFF0C;&amp;#x9700;&amp;#x8981;node&amp;#x7248;&amp;#x672C;7.6&amp;#x4EE5;&amp;#x4E0A;  &amp;#x65B0;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x5939;&amp;#x5">
<meta property="og:type" content="article">
<meta property="og:title" content="Koa2基础学习">
<meta property="og:url" content="http://yoursite.com/2020/03/21/blog11/index.html">
<meta property="og:site_name" content="Coding with cooker&#39; soul">
<meta property="og:description" content="&amp;#x642D;&amp;#x5EFA;koa&amp;#x5F00;&amp;#x53D1;&amp;#x73AF;&amp;#x5883;koa&amp;#x57FA;&amp;#x4E8E;async&amp;#xFF0C;&amp;#x9700;&amp;#x8981;node&amp;#x7248;&amp;#x672C;7.6&amp;#x4EE5;&amp;#x4E0A;  &amp;#x65B0;&amp;#x5EFA;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x5939;&amp;#x5">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-03-21T14:45:45.614Z">
<meta property="article:modified_time" content="2020-03-21T14:46:32.691Z">
<meta property="article:author" content="Leni">
<meta name="twitter:card" content="summary">

    <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Person",
  "email": "mailto:",
  "image": "",
  "name": "Leni",
  "url": "http://yoursite.com"
}
</script>
    <script>
    var algoliaEnabled = false;
    
</script>

    

    
    
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    
    
    
        <!-- stylesheets list from config.yml -->
        
        <link rel="stylesheet" href="/css/aloha.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.css">
        
        <link rel="stylesheet" href="//cdn.bootcss.com/magnific-popup.js/1.1.0/magnific-popup.min.css">
        
    

</head>
<body id="body" style="margin-bottom: 0;" class="pushable">

    <div class="ui top fixed menu">
        <a class="item" id="menu-icon"><i class="sidebar icon"></i></a>
    </div>

    <div id="menu-sidebar" class="ui left vertical sidebar menu">

    <div id="sidebar-top">
        <div class="content">
            <h3>Coding with cooker&#39; soul</h3>
        </div>
    </div>
    <div class="ui container sidebar-card">
    <div class="ui people shape content">
        <div class="active side">
            <div class="ui card">
                <div class="image">
                    <img class="ui medium bordered image" src="/images/avatar.jpg">
                </div>
                <div class="content">
                    <a class="header">Leni</a>
                    
                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                        
                    </div>

                </div>
                <div class="extra content">
                    <div class="ui list">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

    
    

    

    
    <a href="/index.html" class="item" >
        <i class="home icon"></i>
        HOME
    </a>

    

    
</div>

    <div class="pusher body-content">
        <div id="content" class="ui main container">
            <!--<div class="ui one column grid">-->
                <!--<div class="column">-->
                    <!--<div class="ui main container">-->
                        <div id="post-blog11" class="ui main container article-type-post">

    

    <div class="ui divided grid">

        <div class="two column row" id="article-content">

            <div class="thirteen wide computer thirteen wide tablet sixteen wide mobile column">
                

<h1 class="ui header">
    
    Koa2基础学习
</h1>



                <div class="article-inner">

                    <div class="article-entry" itemprop="articleBody">
                        
                        <html><head></head><body><h3 id="&#x642D;&#x5EFA;koa&#x5F00;&#x53D1;&#x73AF;&#x5883;"><a href="#&#x642D;&#x5EFA;koa&#x5F00;&#x53D1;&#x73AF;&#x5883;" class="headerlink" title="&#x642D;&#x5EFA;koa&#x5F00;&#x53D1;&#x73AF;&#x5883;"></a>&#x642D;&#x5EFA;koa&#x5F00;&#x53D1;&#x73AF;&#x5883;</h3><p>koa&#x57FA;&#x4E8E;async&#xFF0C;&#x9700;&#x8981;node&#x7248;&#x672C;7.6&#x4EE5;&#x4E0A;</p>
<ol class="ui list">
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x5E76;&#x8FDB;&#x5165;</li>
<li>&#x751F;&#x6210;package.json&#x6587;&#x4EF6;<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></tbody></table></figure></li>
<li>&#x5B89;&#x88C5;koa&#xFF08;&#x2013;save&#x5B89;&#x88C5;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#xFF09;<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save koa</span><br></pre></td></tr></tbody></table></figure></li>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;index.js<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="comment">// &#x5F02;&#x6B65;&#x8BED;&#x6CD5;&#x7CD6; ctx&#x4E0A;&#x4E0B;&#x6587;</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    ctx.body = <span class="string">&apos;hello,leni&apos;</span></span><br><span class="line">})</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&apos;app is starting at port 3000&apos;</span>)</span><br></pre></td></tr></tbody></table></figure>
&#x7EC8;&#x7AEF;&#x6267;&#x884C;<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></tbody></table></figure>
&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x8F93;&#x5165;127.0.0.1:3000&#x8BBF;&#x95EE;&#x4E86;&#x3002;</li>
</ol>
<hr>
<h3 id="async&#x548C;await&#x7684;&#x4F7F;&#x7528;"><a href="#async&#x548C;await&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="async&#x548C;await&#x7684;&#x4F7F;&#x7528;"></a>async&#x548C;await&#x7684;&#x4F7F;&#x7528;</h3><ol class="ui list">
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;demo01.js, &#x666E;&#x901A;&#x51FD;&#x6570;&#x52A0;&#x4E0A;async&#x5C31;&#x53D8;&#x6210;&#x5F02;&#x6B65;&#x7684;<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSth</span>(<span class="params"></span>)</span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&apos;something&apos;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">testAsync</span>(<span class="params"></span>)</span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&apos;hello,async&apos;</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>{</span><br><span class="line">    <span class="keyword">const</span> v1 = <span class="keyword">await</span> getSth()</span><br><span class="line">    <span class="keyword">const</span> v2 = <span class="keyword">await</span> testAsync()</span><br><span class="line">    <span class="built_in">console</span>.log(v1,v2)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">test() <span class="comment">// something hello async  &#x8BF4;&#x660E;await&#x4E0D;&#x4EC5;&#x80FD;&#x63A5;&#x6536;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x666E;&#x901A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x4E5F;&#x53EF;&#x4EE5;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = testAsync()</span><br><span class="line"><span class="built_in">console</span>.log(result) <span class="comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;promise</span></span><br></pre></td></tr></tbody></table></figure>
await&#x4F1A;&#x9020;&#x6210;&#x963B;&#x585E;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x653E;&#x5728;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#xFF0C;&#x4E0D;&#x7136;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F1A;&#x5D29;&#x6E83;<br>&#x6240;&#x4EE5;await&#x4E24;&#x4E2A;&#x7279;&#x70B9;</li>
</ol>
<ul class="ui list">
<li>&#x5FC5;&#x987B;&#x653E;&#x5728;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x91CC;&#x9762;</li>
<li>&#x4E0D;&#x4EC5;&#x80FD;&#x63A5;&#x6536;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x666E;&#x901A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x4E5F;&#x53EF;&#x4EE5;</li>
</ul>
<hr>
<h3 id="get&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;&#x63A5;&#x6536;"><a href="#get&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;&#x63A5;&#x6536;" class="headerlink" title="get&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;&#x63A5;&#x6536;"></a>get&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;&#x63A5;&#x6536;</h3><p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;demo02.js<br>&#x5728;koa2&#x4E2D;get&#x8BF7;&#x6C42;&#x901A;&#x8FC7;request&#x63A5;&#x6536;&#xFF0C;&#x4F46;&#x662F;&#x63A5;&#x6536;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x4E24;&#x79CD;&#xFF1A;query&#x548C;querystring</p>
<ul class="ui list">
<li>query&#xFF1A;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x683C;&#x5F0F;&#x5316;&#x597D;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x8C61;</li>
<li>querystring&#xFF1A;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x8BF7;&#x6C42;&#x5B57;&#x7B26;&#x4E32;</li>
</ul>
<p>koa&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;request&#x63A5;&#x6536;&#x8BF7;&#x6C42;, &#x89C1;demo</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    <span class="keyword">let</span> url = ctx.url</span><br><span class="line">    <span class="comment">// &#x4ECE;request&#x4E2D;&#x63A5;&#x6536;Get&#x8BF7;&#x6C42;</span></span><br><span class="line">    <span class="keyword">let</span> request = ctx.request</span><br><span class="line">    <span class="keyword">let</span> req_query = request.query</span><br><span class="line">    <span class="keyword">let</span> re_querystring = request.querystring</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//&#x4ECE;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x76F4;&#x63A5;Get&#x8BF7;&#x6C42;</span></span><br><span class="line">    <span class="keyword">let</span> ctx_query = ctx.query</span><br><span class="line">    <span class="keyword">let</span> ctx_querystring = ctx.querystring</span><br><span class="line">    </span><br><span class="line">    ctx.body = {</span><br><span class="line">        url,</span><br><span class="line">        req_query,</span><br><span class="line">        req_querystring,</span><br><span class="line">        ctx_query,</span><br><span class="line">        ctx_querystring </span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;[demo] is starting at port 3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8BBF;&#x95EE;127.0.0.1:3000&#x5E26;&#x53C2;&#x6570;<br>127.0.0.1:3000?name=leni&amp;age=18<br>(&#x53EF;&#x4EE5;&#x5B89;&#x88C5;iformattool&#x63D2;&#x4EF6;)</p>
<hr>
<h3 id="Post&#x8BF7;&#x6C42;&#x5982;&#x4F55;&#x63A5;&#x6536;"><a href="#Post&#x8BF7;&#x6C42;&#x5982;&#x4F55;&#x63A5;&#x6536;" class="headerlink" title="Post&#x8BF7;&#x6C42;&#x5982;&#x4F55;&#x63A5;&#x6536;"></a>Post&#x8BF7;&#x6C42;&#x5982;&#x4F55;&#x63A5;&#x6536;</h3><p>&#x9488;&#x5BF9;post&#x8BF7;&#x6C42;&#xFF0C;koa&#x6CA1;&#x6709;&#x5C01;&#x88C5;&#x65B9;&#x4FBF;&#x7684;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x89E3;&#x6790;&#x4E0A;&#x4E0B;&#x6587;context&#x4E2D;&#x539F;&#x751F;node.js&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;req&#x6765;&#x83B7;&#x53D6;&#x3002;</p>
<h4 id="&#x83B7;&#x53D6;Post&#x8BF7;&#x6C42;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;"><a href="#&#x83B7;&#x53D6;Post&#x8BF7;&#x6C42;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;" class="headerlink" title="&#x83B7;&#x53D6;Post&#x8BF7;&#x6C42;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;"></a>&#x83B7;&#x53D6;Post&#x8BF7;&#x6C42;&#x7684;&#x6B65;&#x9AA4;&#xFF1A;</h4><ol class="ui list">
<li>&#x89E3;&#x6790;&#x4E0A;&#x4E0B;&#x6587;ctx&#x4E2D;&#x7684;&#x539F;&#x751F;node.js&#x7684;req</li>
<li>&#x5C06;Post&#x8868;&#x5355;&#x6570;&#x636E;&#x89E3;&#x6790;&#x6210;query string&#x5B57;&#x7B26;&#x4E32;</li>
<li>&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;JSON&#x683C;&#x5F0F;<h4 id="ctx-request&#x548C;ctx-req&#x7684;&#x533A;&#x522B;"><a href="#ctx-request&#x548C;ctx-req&#x7684;&#x533A;&#x522B;" class="headerlink" title="ctx.request&#x548C;ctx.req&#x7684;&#x533A;&#x522B;"></a>ctx.request&#x548C;ctx.req&#x7684;&#x533A;&#x522B;</h4></li>
</ol>
<ul class="ui list">
<li>ctx.request&#xFF1A;&#x662F;koa2&#x4E2D;contex&#x7ECF;&#x8FC7;&#x5C01;&#x88C5;&#x7684;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#xFF0C;&#x7528;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x76F4;&#x89C2;&#x7B80;&#x5355;</li>
<li>ctx.req&#xFF1A;&#x662F;context&#x63D0;&#x4F9B;&#x7684;node.js&#x539F;&#x751F;Http&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x3002;&#x4E0D;&#x76F4;&#x89C2;&#xFF0C;&#x6709;&#x66F4;&#x591A;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x662F;&#x9002;&#x5408;&#x6DF1;&#x5EA6;&#x7F16;&#x7A0B;</li>
</ul>
<p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;demo03.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    <span class="keyword">if</span>(ctx.url === <span class="string">&apos;/&apos;</span> &amp;&amp; ctx.method === <span class="string">&apos;GET&apos;</span>){</span><br><span class="line">        <span class="comment">// &#x663E;&#x793A;&#x8868;&#x5355;</span></span><br><span class="line">        <span class="keyword">let</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;h1&gt;leni Koa2 request Post&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;form method=&apos;POST&apos; action=&apos;/&apos;&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;userName&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&apos;userName&apos;/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                 &lt;p&gt;age&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;input name=&apos;age&apos;/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">                &lt;button type=&apos;submit&apos;&gt;submit&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">        `</span></span><br><span class="line">        ctx.body = html</span><br><span class="line">    }<span class="keyword">else</span> <span class="keyword">if</span>(ctx.url === <span class="string">&apos;/&apos;</span> &amp;&amp; ctx.method === <span class="string">&apos;POST&apos;</span>){</span><br><span class="line">        ctx.body = <span class="string">&apos;&#x63A5;&#x6536;&#x5230;post&#x53C2;&#x6570;&apos;</span></span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        ctx.body = <span class="string">&apos;&lt;h1&gt;404&lt;/h1&gt;&apos;</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;[demo03] is starting at port 3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<h4 id="&#x89E3;&#x6790;node&#x539F;&#x751F;post&#x53C2;&#x6570;"><a href="#&#x89E3;&#x6790;node&#x539F;&#x751F;post&#x53C2;&#x6570;" class="headerlink" title="&#x89E3;&#x6790;node&#x539F;&#x751F;post&#x53C2;&#x6570;"></a>&#x89E3;&#x6790;node&#x539F;&#x751F;post&#x53C2;&#x6570;</h4><p>&#x7528;promise&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x4F7F;&#x7528;ctx.req.on&#x6765;&#x63A5;&#x6536;&#x4E8B;&#x4EF6;</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>&#xA0;<span class="title">parsePostData</span>(<span class="params">ctx</span>)</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">return</span>&#xA0;<span class="keyword">new</span>&#xA0;<span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">try</span>&#xA0;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;postData&#xA0;=&#xA0;<span class="string">&apos;&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.req.on(<span class="string">&apos;data&apos;</span>,data=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;postData&#xA0;+=&#xA0;data</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.req.addListener(<span class="string">&apos;end&apos;</span>,&#xA0;<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;resolve(postData)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0;<span class="keyword">catch</span>&#xA0;(error)&#xA0;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;reject(error)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x7136;&#x540E;&#x5728;&#x63A5;&#x6536;post&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#xA0;<span class="keyword">let</span>&#xA0;postData&#xA0;=&#xA0;<span class="keyword">await</span>&#xA0;parsePostData(ctx)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;postData</span><br></pre></td></tr></tbody></table></figure>
<h4 id="POST&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x4E3A;JSON&#x5BF9;&#x8C61;"><a href="#POST&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x4E3A;JSON&#x5BF9;&#x8C61;" class="headerlink" title="POST&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x4E3A;JSON&#x5BF9;&#x8C61;"></a>POST&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x4E3A;JSON&#x5BF9;&#x8C61;</h4><p>&#x5199;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x5C01;&#x88C5;&#x6210;JSON&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5;</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>&#xA0;<span class="title">parseQueryStr</span>(<span class="params">queryStr</span>)</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;queryData&#xA0;=&#xA0;{}</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;queryStrList&#xA0;=&#xA0;queryStr.split(<span class="string">&apos;&amp;&apos;</span>)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">for</span>(<span class="keyword">let</span>&#xA0;item&#xA0;<span class="keyword">of</span>&#xA0;queryStrList){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;itemList&#xA0;=&#xA0;item.split(<span class="string">&apos;=&apos;</span>)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(itemList)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;queryData[itemList[<span class="number">0</span>]]&#xA0;=&#xA0;<span class="built_in">decodeURIComponent</span>(itemList[<span class="number">1</span>])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="Koa-bodyparser&#x4E2D;&#x95F4;&#x4EF6;"><a href="#Koa-bodyparser&#x4E2D;&#x95F4;&#x4EF6;" class="headerlink" title="Koa-bodyparser&#x4E2D;&#x95F4;&#x4EF6;"></a>Koa-bodyparser&#x4E2D;&#x95F4;&#x4EF6;</h3><p>&#x5B89;&#x88C5;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save koa-bodyparser@3</span><br></pre></td></tr></tbody></table></figure>
<p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;demo04.js&#xFF0C;&#x590D;&#x7528;&#x4E0A;&#x4E00;&#x4E2A;demo&#x4EE3;&#x7801;</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"><span class="keyword">const</span> bodyparser = <span class="built_in">require</span>(<span class="string">&apos;koa-bodyparser&apos;</span>)</span><br><span class="line"></span><br><span class="line">app.use(bodyparser())</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">if</span>(ctx.url&#xA0;===&#xA0;<span class="string">&apos;/&apos;</span>&#xA0;&amp;&amp;&#xA0;ctx.method&#xA0;===&#xA0;<span class="string">&apos;GET&apos;</span>){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="comment">//&#xA0;&#x663E;&#x793A;&#x8868;&#x5355;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;html&#xA0;=&#xA0;<span class="string">`</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;h1&gt;leni&#xA0;Koa2&#xA0;request&#xA0;Post&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;form&#xA0;method=&apos;POST&apos;&#xA0;action=&apos;/&apos;&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;p&gt;userName&lt;/p&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;input&#xA0;name=&apos;userName&apos;/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;p&gt;age&lt;/p&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;input&#xA0;name=&apos;age&apos;/&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;button&#xA0;type=&apos;submit&apos;&gt;submit&lt;/button&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;`</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;html</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}<span class="keyword">else</span>&#xA0;<span class="keyword">if</span>(ctx.url&#xA0;===&#xA0;<span class="string">&apos;/&apos;</span>&#xA0;&amp;&amp;&#xA0;ctx.method&#xA0;===&#xA0;<span class="string">&apos;POST&apos;</span>){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="comment">//&#xA0;ctx.body&#xA0;=&#xA0;&apos;&#x63A5;&#x6536;&#x5230;post&#x53C2;&#x6570;&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;postData&#xA0;= ctx.request.body</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;postData</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}<span class="keyword">else</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;&lt;h1&gt;404&lt;/h1&gt;&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[demo03]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="koa2&#x539F;&#x751F;&#x8DEF;&#x7531;&#x5B9E;&#x73B0;"><a href="#koa2&#x539F;&#x751F;&#x8DEF;&#x7531;&#x5B9E;&#x73B0;" class="headerlink" title="koa2&#x539F;&#x751F;&#x8DEF;&#x7531;&#x5B9E;&#x73B0;"></a>koa2&#x539F;&#x751F;&#x8DEF;&#x7531;&#x5B9E;&#x73B0;</h3><p>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;demo05.js, &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5939;page&#xFF08;&#x653E;404.html&#xFF0C;index.html&#xFF0C;todo.html&#xFF09;</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&apos;fs&apos;</span>) <span class="comment">// &#x5B9E;&#x73B0;&#x6D41;&#x5DE5;&#x4F5C;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">page</span>)</span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>{</span><br><span class="line">        <span class="keyword">let</span> pageUrl = <span class="string">`./page/<span class="subst">${page}</span>`</span></span><br><span class="line">        fs.readFile(pageUrl, <span class="string">&apos;binary&apos;</span>, (err, data)=&gt;{</span><br><span class="line">            <span class="keyword">if</span>(err){</span><br><span class="line">                reject(err)</span><br><span class="line">            }<span class="keyword">else</span>{</span><br><span class="line">                resolve(data)</span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">route</span>(<span class="params">url</span>)</span>{</span><br><span class="line">    <span class="keyword">let</span> page = <span class="string">&apos;404.html&apos;</span></span><br><span class="line">    <span class="keyword">switch</span>(url){</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&apos;/&apos;</span>:</span><br><span class="line">            page = <span class="string">&apos;index.html&apos;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&apos;/index&apos;</span>:</span><br><span class="line">            page = <span class="string">&apos;index.html&apos;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&apos;/todo&apos;</span>:</span><br><span class="line">            page = <span class="string">&apos;todo.html&apos;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&apos;/404&apos;</span>:</span><br><span class="line">            page = <span class="string">&apos;404.html&apos;</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">let</span> html =<span class="keyword">await</span> render(page)</span><br><span class="line">    <span class="keyword">return</span> html;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    <span class="keyword">let</span> url = ctx.request.url</span><br><span class="line">    <span class="keyword">let</span> html =<span class="keyword">await</span> route(url)</span><br><span class="line">    ctx.body = html</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE&#xA0;<span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&#xA0;<span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&#xA0;<span class="attr">content</span>=<span class="string">&quot;width=device-width,&#xA0;initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Koa&#xA0;demo&#xA0;Index&#xA0;Page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">p</span>&gt;</span>this&#xA0;is&#xA0;Index&#xA0;page<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&#xA0;<span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&#xA0;<span class="attr">href</span>=<span class="string">&quot;/index&quot;</span>&gt;</span>index<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&#xA0;<span class="attr">href</span>=<span class="string">&quot;/todo&quot;</span>&gt;</span>todo<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&#xA0;<span class="attr">href</span>=<span class="string">&quot;/404&quot;</span>&gt;</span>404<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>todo.html</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE&#xA0;<span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&#xA0;<span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&#xA0;<span class="attr">content</span>=<span class="string">&quot;width=device-width,&#xA0;initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Koa&#xA0;demo&#xA0;Todo&#xA0;Page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">p</span>&gt;</span>this&#xA0;is&#xA0;todo&#xA0;page<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>404.html</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE&#xA0;<span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&#xA0;<span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">meta</span>&#xA0;<span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&#xA0;<span class="attr">content</span>=<span class="string">&quot;width=device-width,&#xA0;initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Koa&#xA0;demo&#xA0;404&#xA0;Page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">p</span>&gt;</span>this&#xA0;is&#xA0;404&#xA0;page<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="Koa-router&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;1&#xFF09;"><a href="#Koa-router&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;1&#xFF09;" class="headerlink" title="Koa-router&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;1&#xFF09;"></a>Koa-router&#x4E2D;&#x95F4;&#x4EF6;&#xFF08;1&#xFF09;</h3><p>&#x5B89;&#x88C5;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save koa-router</span><br></pre></td></tr></tbody></table></figure>
<p>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo06.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;Router&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa-router&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"><span class="keyword">const</span>&#xA0;router&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Router()</span><br><span class="line">router</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;.get(<span class="string">&apos;/&apos;</span>,&#xA0;(ctx,&#xA0;next)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;index&#xA0;page&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;.get(<span class="string">&apos;/todo&apos;</span>,&#xA0;(ctx,&#xA0;next)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;todo&#xA0;page&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[demo06]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="Koa-router&#x4E2D;&#x95F4;&#x4EF6;-2-&#x5C42;&#x7EA7;"><a href="#Koa-router&#x4E2D;&#x95F4;&#x4EF6;-2-&#x5C42;&#x7EA7;" class="headerlink" title="Koa-router&#x4E2D;&#x95F4;&#x4EF6; (2) &#x5C42;&#x7EA7;"></a>Koa-router&#x4E2D;&#x95F4;&#x4EF6; (2) &#x5C42;&#x7EA7;</h3><p>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo07.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;Router&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa-router&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> home = <span class="keyword">new</span> Router()</span><br><span class="line">home.get(<span class="string">&apos;/leni&apos;</span>, <span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    ctx.body = <span class="string">&apos;Home leni page&apos;</span></span><br><span class="line">}).get(<span class="string">&apos;/todo&apos;</span>, <span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    ctx.body = <span class="string">&apos;Home todo page&apos;</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> page = <span class="keyword">new</span> Router()</span><br><span class="line">page.get(<span class="string">&apos;/leni&apos;</span>, <span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    ctx.body = <span class="string">&apos;Page leni page&apos;</span></span><br><span class="line">}).get(<span class="string">&apos;/todo&apos;</span>, <span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">    ctx.body = <span class="string">&apos;Page todo page&apos;</span></span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x7236;&#x7EA7;&#x8DEF;&#x7531;, &#x88C5;&#x8F7D;&#x6240;&#x6709;&#x5B50;&#x8DEF;&#x7531;</span></span><br><span class="line"><span class="keyword">const</span>&#xA0;router&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Router()</span><br><span class="line">router.use(<span class="string">&apos;/home&apos;</span>, home.routes(), home.allowedMethods())</span><br><span class="line">.use(<span class="string">&apos;/page&apos;</span>, page.routes(), page.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x52A0;&#x8F7D;&#x8DEF;&#x7531;&#x4E2D;&#x95F4;&#x4EF6;</span></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[demo07]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="Koa-router&#x4E2D;&#x95F4;&#x4EF6;-3-&#x53C2;&#x6570;"><a href="#Koa-router&#x4E2D;&#x95F4;&#x4EF6;-3-&#x53C2;&#x6570;" class="headerlink" title="Koa-router&#x4E2D;&#x95F4;&#x4EF6; (3) &#x53C2;&#x6570;"></a>Koa-router&#x4E2D;&#x95F4;&#x4EF6; (3) &#x53C2;&#x6570;</h3><p>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo08.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&apos;koa-router&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&apos;/&apos;</span>, (ctx,next)=&gt;{</span><br><span class="line">    ctx.body = ctx.query</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;[demo08] is starting at port 3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="cookie&#x7684;&#x4F7F;&#x7528;"><a href="#cookie&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="cookie&#x7684;&#x4F7F;&#x7528;"></a>cookie&#x7684;&#x4F7F;&#x7528;</h3><p>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo09.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;<span class="keyword">if</span>(ctx.url&#xA0;===&#xA0;<span class="string">&apos;/index&apos;</span>){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.cookies.set(</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="string">&apos;MyName&apos;</span>,&#xA0;<span class="string">&apos;Leni&apos;</span>,&#xA0;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;domain:&#xA0;<span class="string">&apos;127.0.0.1&apos;</span>,</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;path:&#xA0;<span class="string">&apos;/&apos;</span>,&#xA0;<span class="comment">//&#xA0;&#x6539;&#x4E3A;/index&#x7684;&#x8BDD;&#xFF0C;&#x53EA;&#x6709;&#x8DEF;&#x5F84;&#x4E3A;/index&#x65F6;&#x624D;&#x80FD;&#x8BBF;&#x95EE;&#x5230;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;maxAge:&#xA0;<span class="number">1000</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>,</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;expires:&#xA0;<span class="keyword">new</span>&#xA0;<span class="built_in">Date</span>(<span class="string">&apos;2020-03-01&apos;</span>),</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;httpOnly:&#xA0;<span class="literal">false</span>,</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;overwirte:&#xA0;<span class="literal">false</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;Cookie&#xA0;is&#xA0;ok&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;}<span class="keyword">else</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">if</span>(ctx.cookies.get(<span class="string">&apos;MyName&apos;</span>)){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;ctx.cookies.get(<span class="string">&apos;MyName&apos;</span>)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<span class="keyword">else</span>{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;hello,&#xA0;leni&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">&#xA0;&#xA0;&#xA0;}</span><br><span class="line">})</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[demo09]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="ejs&#x6A21;&#x677F;"><a href="#ejs&#x6A21;&#x677F;" class="headerlink" title="ejs&#x6A21;&#x677F;"></a>ejs&#x6A21;&#x677F;</h3><p>&#x5B89;&#x88C5;&#x4E2D;&#x95F4;&#x4EF6;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save koa-views</span><br></pre></td></tr></tbody></table></figure>
<p>&#x5B89;&#x88C5;ejs&#x6A21;&#x677F;&#x5F15;&#x64CE;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save ejs</span><br></pre></td></tr></tbody></table></figure>
<p>&#x7F16;&#x5199;&#x6A21;&#x677F;&#xFF0C;&#x4E3A;&#x4E86;&#x6A21;&#x677F;&#x540C;&#x4E00;&#x7BA1;&#x7406;&#xFF0C;&#x65B0;&#x5EFA;&#x6587;&#x4EF6;&#x5939;view&#xFF08;&#x542B;index.ejs&#xFF09;<br>views/index.ejs</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE&#xA0;<span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span>&#xA0;<span class="attr">title</span>&#xA0;%&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span>&#xA0;<span class="attr">title</span>&#xA0;%&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="tag">&lt;<span class="name">p</span>&gt;</span>EJS&#xA0;Welcome&#xA0;to&#xA0;<span class="tag">&lt;<span class="name">%=</span>&#xA0;<span class="attr">title</span>&#xA0;%&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo10.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"><span class="keyword">const</span>&#xA0;path&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;path&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;views&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa-views&apos;</span>)</span><br><span class="line">app.use(views(path.join(__dirname,<span class="string">&apos;./views&apos;</span>),{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;extension:&#xA0;<span class="string">&apos;ejs&apos;</span></span><br><span class="line">}))</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">let</span>&#xA0;title&#xA0;=&#xA0;<span class="string">&apos;hello,&#xA0;koa2&apos;</span></span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="keyword">await</span>&#xA0;ctx.render(<span class="string">&apos;index&apos;</span>,&#xA0;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;title</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;})</span><br><span class="line">})</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[dmeo10]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h3 id="koa-static&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E2D;&#x95F4;&#x4EF6;"><a href="#koa-static&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E2D;&#x95F4;&#x4EF6;" class="headerlink" title="koa-static&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E2D;&#x95F4;&#x4EF6;"></a>koa-static&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E2D;&#x95F4;&#x4EF6;</h3><p>&#x5B89;&#x88C5;koa-static</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save koa-static</span><br></pre></td></tr></tbody></table></figure>
<p>&#x65B0;&#x5EFA;static&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x653E;&#x5165;&#x9759;&#x6001;&#x8D44;&#x6E90;<br>&#x65B0;&#x5EFA;&#x6587;&#x4EF6;demo11.js</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>&#xA0;Koa&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;path&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;path&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;<span class="keyword">static</span>&#xA0;=&#xA0;<span class="built_in">require</span>(<span class="string">&apos;koa-static&apos;</span>)</span><br><span class="line"><span class="keyword">const</span>&#xA0;app&#xA0;=&#xA0;<span class="keyword">new</span>&#xA0;Koa()</span><br><span class="line"><span class="keyword">const</span>&#xA0;staticPath&#xA0;=&#xA0;<span class="string">&apos;./static&apos;</span></span><br><span class="line">app.use(<span class="keyword">static</span>(path.join(__dirname,staticPath)))</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx)=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;ctx.body&#xA0;=&#xA0;<span class="string">&apos;hello,&#xA0;world&apos;</span></span><br><span class="line">})</span><br><span class="line">app.listen(<span class="number">3000</span>,&#xA0;()=&gt;{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;<span class="built_in">console</span>.log(<span class="string">&apos;[dmeo11]&#xA0;is&#xA0;starting&#xA0;at&#xA0;port&#xA0;3000&apos;</span>)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8BBF;&#x95EE;127.0.0.1:3000/index.js(&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x540D;)&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E86;</p>
<hr>
<h3 id="&#x8865;&#x5145;"><a href="#&#x8865;&#x5145;" class="headerlink" title="&#x8865;&#x5145;"></a>&#x8865;&#x5145;</h3><p>app.use(function): &#x5C06;&#x7ED9;&#x5B9A;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;&#x6B64;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;<br>demo&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/leniNikky/koa-simple-demo" target="_blank" rel="noopener">https://github.com/leniNikky/koa-simple-demo</a></p>
</body></html>
                        
                    </div>

                    
                    
                    

                    <div class="description post-description">
    <span class="post-description-item">
        <time datetime="2020-03-21T14:45:45.614Z" itemprop="datePublished">2020-03-21</time>

    </span>
    <span class="post-description-item">
        
    </span>
</div>

                </div>
                
                <div id="pagination" class="nav-web ui text container pagination">

    <div class="ui stackable two column divided grid container">
        <div class="row">
            <div class="column nav-left">
                

                <a class="ui tiny button disabled"><i class="angle left icon"></i>Previous</a>

                
            </div>
            <div class="column nav-right">
                

                <a href="/2020/03/14/blog10/" class="ui tiny button">
                    
                    安卓（kotlin）自定义弹出框
                    
                    <i class="angle right icon"></i></a>
                
            </div>
        </div>
    </div>

</div>
                
            </div>

            
            <div class="three wide computer three wide tablet column">

                <div class="ui sticky article-toc" id="article-toc">
                    <!-- toc -->
                    <ol class="ui ordered list"><li><a href="#搭建koa开发环境"><span>搭建koa开发环境</span></a></li><li><a href="#async和await的使用"><span>async和await的使用</span></a></li><li><a href="#get请求数据的接收"><span>get请求数据的接收</span></a></li><li><a href="#Post请求如何接收"><span>Post请求如何接收</span></a><ol><li><a href="#获取Post请求的步骤："><span>获取Post请求的步骤：</span></a></li><li><a href="#ctx-request和ctx-req的区别"><span>ctx.request和ctx.req的区别</span></a></li><li><a href="#解析node原生post参数"><span>解析node原生post参数</span></a></li><li><a href="#POST字符串解析为JSON对象"><span>POST字符串解析为JSON对象</span></a></li></ol></li><li><a href="#Koa-bodyparser中间件"><span>Koa-bodyparser中间件</span></a></li><li><a href="#koa2原生路由实现"><span>koa2原生路由实现</span></a></li><li><a href="#Koa-router中间件（1）"><span>Koa-router中间件（1）</span></a></li><li><a href="#Koa-router中间件-2-层级"><span>Koa-router中间件 (2) 层级</span></a></li><li><a href="#Koa-router中间件-3-参数"><span>Koa-router中间件 (3) 参数</span></a></li><li><a href="#cookie的使用"><span>cookie的使用</span></a></li><li><a href="#ejs模板"><span>ejs模板</span></a></li><li><a href="#koa-static静态资源中间件"><span>koa-static静态资源中间件</span></a></li><li><a href="#补充"><span>补充</span></a></li></ol>
                </div>

            </div>
            

        </div>
    </div>
</div>


                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        </div>
        <div class="ui vertical footer segment">
    <div class="ui center aligned container">
        <div class="ui inverted section divider"></div>
        &copy; 2020 <a href="/">Leni</a>,
        <a href="https://github.com/leniNikky" target="_blank">my github</a>.
    </div>
</div>

    </div>




<!-- scripts list from theme config.yml -->

<script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>

<script src="//cdn.bootcss.com/semantic-ui/2.2.4/semantic.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch/3.18.1/algoliasearch.min.js"></script>

<script src="//cdn.bootcss.com/algoliasearch-helper-js/2.13.0/algoliasearch.helper.min.js"></script>

<script src="/js/semantic-ui-algolia.js"></script>

<script src="/js/aloha-events.js"></script>



</body>
</html>
